{%-if include.category-%}
  {%-assign posts = site.categories[include.category]-%}  
{%-else-%}
  {%-assign posts = site.posts-%}
{%-endif-%}

{%-if include.limit and posts.size > include.limit-%}
  {%-assign limit_exceeded = true-%}
{%-else-%}
  {%-assign limit_exceeded = false-%}
{%-endif-%}

{%- if posts.size > 0 -%}
  <!-- Collect all unique categories and languages -->
  {%- assign all_categories = "" | split: "" -%}
  {%- assign all_languages = "" | split: "" -%}
  {%- for post in posts -%}
    {%- if post.category and post.category != "" -%}
      {%- assign all_categories = all_categories | push: post.category -%}
    {%- endif -%}
    {%- if post.lang and post.lang != "" -%}
      {%- assign all_languages = all_languages | push: post.lang -%}
    {%- endif -%}
  {%- endfor -%}
  {%- assign unique_categories = all_categories | uniq | sort -%}
  {%- assign unique_languages = all_languages | uniq | sort -%}
  
  <!-- Filter Section -->
  <div class="post-filters">
    <div class="filter-group">
      <label class="filter-label">Filter by:</label>
      <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">All</button>
        {%- for lang in unique_languages -%}
          <button class="filter-btn" data-filter="lang-{{ lang }}">üåê {{ lang | upcase }}</button>
        {%- endfor -%}
        {%- for category in unique_categories -%}
          <button class="filter-btn" data-filter="cat-{{ category }}">{{ category }}</button>
        {%- endfor -%}
      </div>
    </div>
  </div>
  
  <div class="post-grid">
    {%- for post in posts limit: include.limit -%}
        {%- assign words = post.content | number_of_words -%}
        {%- assign read_time = words | divided_by: 200 -%}
        {%- if read_time == 0 -%}
          {%- assign read_time = 1 -%}
        {%- endif -%}
        <article class="post-card" data-lang="{{ post.lang }}" data-category="{{ post.category }}">
          <div class="post-card-image">
            {%- if post.image -%}
              <img src="{{ post.image }}" alt="{{ post.title }}" loading="lazy">
            {%- else -%}
              <div class="post-card-placeholder">
                <span class="placeholder-icon">üìù</span>
              </div>
            {%- endif -%}
          </div>
          <div class="post-card-content">
            <h2 class="post-card-title">
              <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
            </h2>
            <div class="post-meta">
              <time datetime="{{ post.date }}">{{- post.date | date: site.theme_config.date_format -}}</time>
              <span class="read-time">üìñ {{ read_time }} min</span>
              {%- if post.lang -%}
                <span class="lang-tag">üåê {{ post.lang | upcase }}</span>
              {%- endif -%}
            </div>
            {%- if post.description -%}
              <p class="post-excerpt">{{ post.description }}</p>
            {%- endif -%}
            {%- if post.category -%}
              <div class="post-card-footer">
                <span class="category">{{ post.category }}</span>
              </div>
            {%- endif -%}
          </div>
        </article>
    {%- endfor -%}
  </div>
  {%- if include.show_more and limit_exceeded -%}
    <div class="show-more-container">
      <a href="{{ include.show_more_url | relative_url }}" class="show-more-btn">{{ include.show_more_text | default: "Show more..." }}</a>
    </div>
  {%- endif -%}
{%- endif -%}