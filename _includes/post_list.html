{%-if include.category-%}
  {%-assign posts = site.categories[include.category]-%}  
{%-else-%}
  {%-assign posts = site.posts-%}
{%-endif-%}

{%-if include.limit and posts.size > include.limit-%}
  {%-assign limit_exceeded = true-%}
{%-else-%}
  {%-assign limit_exceeded = false-%}
{%-endif-%}

{%- if posts.size > 0 -%}
  <!-- Collect all unique categories and languages -->
  {%- assign all_categories = "" | split: "" -%}
  {%- assign all_languages = "" | split: "" -%}
  {%- for post in posts -%}
    {%- if post.category and post.category != "" -%}
      {%- assign all_categories = all_categories | push: post.category -%}
    {%- endif -%}
    {%- if post.lang and post.lang != "" -%}
      {%- assign all_languages = all_languages | push: post.lang -%}
    {%- endif -%}
  {%- endfor -%}
  {%- assign unique_categories = all_categories | uniq | sort -%}
  {%- assign unique_languages = all_languages | uniq | sort -%}
  
  <div class="filters">
    <button class="filter active" data-filter="all">All</button>
    {%- for category in unique_categories -%}
      <button class="filter" data-filter="cat-{{ category }}">{{ category }}</button>
    {%- endfor -%}
    {%- for lang in unique_languages -%}
      <button class="filter" data-filter="lang-{{ lang }}">{{ lang | upcase }}</button>
    {%- endfor -%}
  </div>
  
  <ul class="posts">
    {%- for post in posts limit: include.limit -%}
        <li class="post" data-lang="{{ post.lang }}" data-category="{{ post.category }}">
          <a href="{{ post.url | relative_url }}" class="post-link">
            <span class="post-title">{{ post.title }}</span>
            {%- if post.description -%}
              <span class="post-desc"> â€” {{ post.description }}</span>
            {%- endif -%}
            <span class="post-meta">
              <span class="post-date">({{ post.date | date: "%b %d, %Y" }})</span>
              {%- if post.category -%}
                <span class="post-tag">[{{ post.category }}]</span>
              {%- endif -%}
            </span>
          </a>
        </li>
    {%- endfor -%}
  </ul>
  {%- if include.show_more and limit_exceeded -%}
    <div class="show-more-container">
      <a href="{{ include.show_more_url | relative_url }}" class="show-more-btn">{{ include.show_more_text | default: "Show more..." }}</a>
    </div>
  {%- endif -%}
{%- endif -%}